!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n=[{state:"all",text:"All",value:"all"},{state:"active",text:"Active",value:!1},{state:"completed",text:"Completed",value:!0}],i="drag-element",o="drag-over-top",a="drag-over-bottom",l="input-todo",s="add-todo",d="toggle-todo",u="update-todo",c="update-active-count",v="insert-todo",f="filter-todo",h="load-todos",p="clear-todos",m="update-filter-value",g="drop-todo",y="emit-drop";function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return E(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.todos=[],this.activeCount=0,this.emitter=t}var t,r,n;return t=e,(r=[{key:"getTodo",value:function(e){return this.todos.find((function(t){return t.id===e}))}},{key:"getTodoIndex",value:function(e){return this.todos.findIndex((function(t){return t.id===e}))}},{key:"addTodo",value:function(e){return this.todos.push(e),this.updateActiveCount(e.completed),this.emitter.fire(c,this.activeCount),e}},{key:"updateTodo",value:function(e,t){var r=this.getTodo(e);return Object.keys(t).forEach((function(e){r[e]=t[e]})),this.updateActiveCount(r.completed),this.emitter.fire(c,this.activeCount),r}},{key:"moveTodoTo",value:function(e,t){var r=this.getTodoIndex(e.id),n=b(this.todos.splice(r,1),1)[0];this.todos.splice(t,0,n)}},{key:"insertTodo",value:function(e,t,r){var n=this.getTodoIndex(e.id),i=b(this.todos.splice(n,1),1)[0],o=this.getTodoIndex(t.id),a=r?1:0;this.todos.splice(o+a,0,i)}},{key:"clearTodos",value:function(e,t){return this.todos=this.getFilteredTodos(e,t),this.activeCount=this.todos.length,this.emitter.fire(c,this.activeCount),this.todos}},{key:"removeTodo",value:function(e){var t=this.todos.findIndex((function(t){return t.id===e}));return t>-1&&(this.todos.splice(t,1),!0)}},{key:"getFilteredTodos",value:function(e,t){return"all"===t?this.todos:this.todos.filter((function(r){return r[e]===t}))}},{key:"updateActiveCount",value:function(e){this.activeCount+=e?-1:1}},{key:"setEmitter",value:function(e){this.emitter=e}},{key:"length",get:function(){return this.todos.length}}])&&T(t.prototype,r),n&&T(t,n),e}();function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function C(e){return"string"==typeof e||e instanceof String}function L(e){return e===Object(e)}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!C(e))throw new Error("A first argument should be a string for DOM tag name");if(!L(t))throw new Error("A second argument should be a object for DOM attributes");var r=document.createElement(e);return Object.keys(t).forEach((function(e){r.setAttribute(e,t[e])})),r}var S=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events={}}var t,r,n;return t=e,(r=[{key:"on",value:function(e,t){if(!C(e))throw new Error("A first argument should be a string for event name");if(r=t,"[object Function]"!==Object.prototype.toString.call(r))throw new Error("A second argument should be a function");var r;this.events[e]=this.events[e]||[],this.events[e].push(t)}},{key:"fire",value:function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))}},{key:"off",value:function(e){this.events[e]&&delete this.events[e]}}])&&k(t.prototype,r),n&&k(t,n),e}();function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var O=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.emitter=t,this.input=null,this.defaultPlaceHolder="What needs to be done?"}var t,r,n;return t=e,(r=[{key:"createElements",value:function(){var e=this,t=H("div",{class:"todo-input"});return this.input=H("input",{placeholder:this.defaultPlaceHolder}),this.input.addEventListener("keypress",(function(t){var r=t.key,n=t.target;if("Enter"===r){var i=n.value;i&&e.emitter.fire(l,i),n.value=""}})),t.appendChild(this.input),t}}])&&D(t.prototype,r),n&&D(t,n),e}();function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var P=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.emitters={},this.dragEl=null,this.previewEl=null,this.previewHTML="",this.enterTime=null,this.shiftPositionOnDragEl={},this.lastDragTarget=null,this.lastDragTargetRect=null,this.setEventHandler()}var t,r,n;return t=e,(r=[{key:"draggable",value:function(e){var t=this;document.querySelectorAll(e).forEach((function(e){e.setAttribute("draggable","true"),t.removeDragHandlers(e),t.addDragHandlers(e)}))}},{key:"dropzone",value:function(e){var t=this,r=document.querySelector(e),n=A(e.split("#"),2)[1];if(this.addDropHandlers(r),this.emitters[n])return this.emitters[n].emitter;var i={emitter:new S,dragElement:null,dropElement:r};return this.emitters[n]=i,i.emitter.on(y,(function(e){var r=e.e,n=e.isInsertToTop;i.dragElement=t.dragEl;var o=r.clientX,a=r.clientY,l=i.dragElement,s=i.dropElement,d=s.getBoundingClientRect(),u=t.getShiftPositionOnElement(o,a,d);i.emitter.fire(g,{e:r,dragElement:l,dropElement:s,isInsertToTop:n,isContain:t.isContain(t.shiftPositionOnDragEl,u)})})),i.emitter}},{key:"setEventHandler",value:function(){var e=this;this.dragstartHandler=function(t){var r=t.currentTarget,n=t.dataTransfer,o=r.getBoundingClientRect();n.dropEffect="move",r.classList.add(i),e.previewHTML=r.outerHTML,e.dragEl=r,e.shiftPositionOnDragEl=e.getShiftPositionOnElement(t.clientX,t.clientY,o)},this.dragenterHandler=function(){e.enterTime=Date.now()},this.dragoverHandler=function(t){t.preventDefault();var r=t.currentTarget,n=t.dataTransfer,i=t.clientY,l=Date.now()-e.enterTime>=2e3&&r!==e.dragEl;r!==e.dragEl&&(e.lastDragTarget!==r&&(e.lastDragTarget=r,e.lastDragTargetRect=r.getBoundingClientRect()),e.isInsertToTop(i)?(r.classList.remove(a),r.classList.add(o)):(r.classList.remove(o),r.classList.add(a)),n.dropEffect="move",l&&e.addPreviewElements(r,t))},this.dragleaveHandler=function(e){var t=e.currentTarget;t.classList.remove(o),t.classList.remove(a)},this.dropHandler=function(t){var r,n=t.currentTarget,i=t.clientY,o=n.parentNode,a=e.isValidDrop(e.dragEl,n,i),l=e.isInsertToTop(i);if(a&&(l?(o.insertBefore(e.dragEl,n),r=e.dragEl.nextSibling):(o.insertBefore(e.dragEl,n.nextSibling),r=e.dragEl.previousSibling)),e.previewEl&&e.removePreviewElements(),e.removeDnDClass(n),a){var s=r.getAttribute("id"),d=e.emitters[s];d&&d.emitter.fire(y,{e:t,isInsertToTop:l})}},this.dragendHandler=function(t){var r=t.currentTarget;e.previewEl&&e.removePreviewElements(),e.removeDnDClass(r)},this.previewDragOverHandler=function(e){return e.preventDefault()}}},{key:"addPreviewElements",value:function(e,t){var r=this.isInsertToTop(t.clientY);this.previewEl&&this.removePreviewElements(),r?(this.previewTargetEl=e.previousSibling,e.insertAdjacentHTML("beforebegin",this.previewHTML),this.previewEl=e.previousSibling):(this.previewTargetEl=e,e.insertAdjacentHTML("afterend",this.previewHTML),this.previewEl=e.nextSibling),this.previewEl.classList.add("preview")}},{key:"removePreviewElements",value:function(){this.removePreviewHandlers(),this.previewEl.parentNode.removeChild(this.previewEl),this.previewEl=null}},{key:"addDragHandlers",value:function(e){e.addEventListener("dragstart",this.dragstartHandler),e.addEventListener("dragleave",this.dragleaveHandler),e.addEventListener("dragend",this.dragendHandler),e.addEventListener("dragenter",this.dragenterHandler)}},{key:"removeDragHandlers",value:function(e){e.removeEventListener("dragstart",this.dragstartHandler),e.removeEventListener("dragleave",this.dragleaveHandler),e.removeEventListener("dragend",this.dragendHandler),e.removeEventListener("dragenter",this.dragenterHandler)}},{key:"addDropHandlers",value:function(e){e.addEventListener("dragover",this.dragoverHandler),e.addEventListener("drop",this.dropHandler)}},{key:"removeDropHandlers",value:function(e){e.removeEventListener("dragover",this.dragoverHandler),e.removeEventListener("drop",this.dropHandler)}},{key:"removeDnDClass",value:function(e){e.classList.remove(a),e.classList.remove(o),e.classList.remove(i)}},{key:"addPreviewHandlers",value:function(){this.previewEl.addEventListener("drop",this.dropHandler),this.previewEl.addEventListener("dragover",this.previewDragOverHandler)}},{key:"removePreviewHandlers",value:function(){this.previewEl.removeEventListener("drop",this.dropHandler),this.previewEl.removeEventListener("dragover",this.previewDragOverHandler)}},{key:"removeDropzone",value:function(e){var t=this.emitters[e];t.emitter.off(y),this.removeDropHandlers(t.dropElement),delete this.emitters[e]}},{key:"isInsertToTop",value:function(e){var t=this.lastDragTargetRect;return t.top+t.height/2>e}},{key:"isValidDrop",value:function(e,t,r){return e!==t&&this.lastDragTarget&&this.isSiblingDrop(e,t,r)}},{key:"isSiblingDrop",value:function(e,t,r){var n=e.previousSibling!==t&&e.nextSibling!==t,i=e.previousSibling===t&&this.isInsertToTop(r),o=e.nextSibling===t&&!this.isInsertToTop(r);return n||i||o}},{key:"isContain",value:function(e,t){return!Object.keys(t).some((function(r){return t[r]<e[r]}))}},{key:"getShiftPositionOnElement",value:function(e,t,r){var n=t-r.top,i=e-r.left;return{top:n,left:i,right:r.width-i,bottom:r.height-n}}}])&&I(t.prototype,r),n&&I(t,n),e}();function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var M=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.emitter=t,this.dnd=new P,this.todoList=null,this.toggleHandler=null,this.filterValue="all",this.emitter.on(s,this.addTodoElements.bind(this)),this.emitter.on(u,this.updateTodoElements.bind(this)),this.emitter.on(h,this.loadTodos.bind(this)),this.emitter.on(m,this.updateFilterValue.bind(this))}var t,r,i;return t=e,(r=[{key:"createElements",value:function(){return this.todoList=H("ul",{class:"todo-list"}),this.todoList}},{key:"loadTodos",value:function(e){for(var t=this,r=this.todoList;r.firstChild;){var n=r.firstChild,i=n.getAttribute("id");n.removeEventListener("click",this.toggleHandler),this.dnd.removeDropzone(i),r.removeChild(r.firstChild)}e.forEach((function(e){return t.addTodoElements(e)}))}},{key:"addTodoElements",value:function(e){var t=this,r=e.title;if(!C(r))throw new Error("A first arguments is a string for todo title");if(r&&this.isValidTodoState(e.completed)){var n=this.todoList.firstChild||null,i=this.createTodoElements(e);this.todoList.insertBefore(i,n),this.dnd.draggable("#".concat(e.id)),this.dnd.dropzone("#".concat(e.id)).on(g,(function(e){var r=e.dragElement,n=e.dropElement,i=e.isInsertToTop,o=r.getAttribute("id"),a=n.getAttribute("id");t.emitter.fire(v,{dragId:o,dropId:a,isInsertToTop:i})}))}}},{key:"updateTodoElements",value:function(e){var t=this.todoList,r=t.querySelector("#".concat(e.id)),n=r.querySelector("input"),i=r.querySelector("label");this.isValidTodoState(e.completed)?e.completed?(n.checked=!0,i.classList.add("completed"),t.appendChild(r)):(n.checked=!1,i.classList.remove("completed"),t.insertBefore(r,t.firstChild)):(r.removeEventListener("click",this.toggleHandler),t.removeChild(r))}},{key:"createTodoElements",value:function(e){var t=this,r=e.id,n=e.title,i=e.completed,o=H("li",{class:"todo-item",id:r}),a=H("input",{type:"checkbox",class:"todo-check"}),l=H("label",{class:"todo-label"});return i&&(a.checked=!0,l.classList.add("completed")),l.textContent=n,o.appendChild(a),o.appendChild(l),this.toggleHandler=function(e){var r=e.currentTarget,n=r.querySelector("label").classList.contains("completed"),i=r.getAttribute("id");t.emitter.fire(d,{id:i,completed:n})},o.addEventListener("click",this.toggleHandler),o}},{key:"updateFilterValue",value:function(e){var t=n.find((function(t){return t.state===e}));this.filterValue=t.value}},{key:"isValidTodoState",value:function(e){return"all"===this.filterValue||e===this.filterValue}}])&&x(t.prototype,r),i&&x(t,i),e}();function V(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.emitter=t,this.emitter.on(c,this.updateActiveCount.bind(this))}var t,r,i;return t=e,(r=[{key:"createElements",value:function(){var e=H("div",{class:"todo-info"}),t=this.createActiveItemCounterElements(),r=this.createTodoFilterElements(),n=this.createClearCompletedElements();return e.appendChild(t),e.appendChild(r),e.appendChild(n),e}},{key:"createActiveItemCounterElements",value:function(){var e=H("span",{class:"todo-count"}),t=H("span",{class:"number"});return t.textContent=0,e.appendChild(t),e.appendChild(document.createTextNode(" item left")),e}},{key:"createTodoFilterElements",value:function(){var e=H("span",{class:"todo-filter"});return this.createRadioElements(n,e)}},{key:"createRadioElements",value:function(e,t){var r=this;return e.reduce((function(e,t,n){var i=t.state,o=t.text,a=H("input",{type:"radio",name:"filter",id:i,value:i});a.checked=0===n,a.addEventListener("change",(function(e){r.emitter.fire(f,e.target.value)}));var l=H("label",{for:i});return l.textContent=o,e.appendChild(a),e.appendChild(l),e}),t)}},{key:"createClearCompletedElements",value:function(){var e=this,t=H("button",{class:"todo-clear"});return t.textContent="Clear completed",t.addEventListener("click",(function(){e.emitter.fire(p)})),t}},{key:"updateActiveCount",value:function(e){document.querySelector(".todo-count .number").textContent=e}}])&&V(t.prototype,r),i&&V(t,i),e}();function F(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var R=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t,this.emitter=r}var t,r,n;return t=e,(r=[{key:"init",value:function(){var e=H("div",{class:"todo-container"}),t=new O(this.emitter),r=new M(this.emitter),n=new q(this.emitter);e.appendChild(t.createElements()),e.appendChild(r.createElements()),e.appendChild(n.createElements()),this.target.appendChild(e)}}])&&F(t.prototype,r),n&&F(t,n),e}();function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.view=r,this.emitter=n,this.emitter.on(l,this.addTodo.bind(this)),this.emitter.on(d,this.toggleTodo.bind(this)),this.emitter.on(f,this.filterTodo.bind(this)),this.emitter.on(p,this.clearTodo.bind(this)),this.emitter.on(v,this.moveTodo.bind(this))}var t,r,i;return t=e,(r=[{key:"boot",value:function(){this.view.init()}},{key:"addTodo",value:function(e){var t=this.model.addTodo({id:"todo-".concat(Date.now()),title:e,completed:!1});this.emitter.fire(s,t)}},{key:"toggleTodo",value:function(e){var t=e.id,r=e.completed,n=this.model.updateTodo(t,{completed:!r}),i=n.completed?0:this.model.length-1;this.model.moveTodoTo(n,i),this.emitter.fire(u,n)}},{key:"filterTodo",value:function(e){var t=n.find((function(t){return t.state===e})),r=this.model.getFilteredTodos("completed",t.value);this.emitter.fire(m,e),this.emitter.fire(h,r)}},{key:"clearTodo",value:function(){var e=n.find((function(e){return"active"===e.state})),t=this.model.clearTodos("completed",e.value);this.emitter.fire(h,t)}},{key:"moveTodo",value:function(e){var t=e.dragId,r=e.dropId,n=e.isInsertToTop,i=this.model.getTodo(t),o=this.model.getTodo(r);this.model.insertTodo(i,o,n)}}])&&B(t.prototype,r),i&&B(t,i),e}(),Y=document.querySelector("#app"),z=new S;new _(new w(z),new R(Y,z),z).boot()}]);
//# sourceMappingURL=bundle.js.map